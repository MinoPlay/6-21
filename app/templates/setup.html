{% extends "base.html" %}

{% block title %}Setup - Habit Tracker{% endblock %}

{% block content %}
<div class="setup-container">
    <h1 class="page-title">ğŸ¯ Setup Your 6 Habits</h1>
    <p class="page-subtitle">Welcome, <strong>{{ user.username }}</strong>! Choose 6 habits you want to track for the next 21 days</p>
    
    {% if existing_habits %}
    <div class="warning-box">
        <p>âš ï¸ You already have habits set up. Creating new ones will replace the existing habits and delete all tracking data.</p>
    </div>
    {% endif %}
    
    <form method="POST" class="setup-form" id="setupForm">
        {% for i in range(1, 7) %}
        <div class="form-group">
            <label for="habit_{{ i }}" class="form-label">Habit {{ i }}</label>
            <input 
                type="text" 
                id="habit_{{ i }}" 
                name="habit_{{ i }}" 
                class="form-input"
                placeholder="e.g., Exercise for 30 minutes"
                maxlength="100"
                required
                {% if existing_habits and existing_habits|length >= i %}
                value="{{ existing_habits[i-1].name }}"
                {% endif %}
            >
        </div>
        {% endfor %}
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary btn-large">
                {% if existing_habits %}
                ğŸ”„ Update Habits
                {% else %}
                âœ¨ Start Tracking
                {% endif %}
            </button>
        </div>
    </form>
    
    {% if existing_habits %}
    <div class="additional-actions">
        <a href="{{ url_for('main.export_data') }}" class="btn btn-secondary" download>
            ğŸ’¾ Export Data (JSON)
        </a>
        <form method="POST" action="{{ url_for('main.reset_challenge') }}" style="display: inline;" 
              onsubmit="return confirm('Are you sure you want to reset all entries and start a new 21-day challenge? Your habits will remain, but all completion data will be deleted.');">
            <button type="submit" class="btn btn-warning">
                ğŸ”„ Reset Challenge
            </button>
        </form>
    </div>
    
    <div class="danger-zone">
        <h3>âš ï¸ Danger Zone</h3>
        <p>Delete all your data including habits, entries, and achievements. This action cannot be undone.</p>
        <button type="button" class="btn btn-danger" onclick="confirmDeleteAccount()">
            ğŸ—‘ï¸ Delete My Data
        </button>
    </div>
    {% endif %}
</div>

<script>
function confirmDeleteAccount() {
    const username = '{{ user.username }}';
    if (confirm(`Are you absolutely sure you want to delete all data for ${username}?\n\nThis will permanently delete:\nâ€¢ All 6 habits\nâ€¢ All completion entries\nâ€¢ All achievements\n\nThis action CANNOT be undone.`)) {
        if (confirm('Final confirmation: Delete everything?')) {
            fetch('/api/user/delete', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('All data deleted successfully.');
                    localStorage.removeItem('habitTrackerUsername');
                    window.location.href = '/user/select';
                } else {
                    alert('Error: ' + (data.error || 'Unknown error'));
                }
            })
            .catch(error => {
                alert('Error deleting data: ' + error);
            });
        }
    }
}
</script>
{% endblock %}
